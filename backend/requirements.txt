fastapi>=0.109.0
uvicorn[standard]>=0.27.0











































































































































































































































No frontend rebuild needed - it adapts automatically!5. Monitor backend logs for any auth errors4. Test OAuth flow in production3. Frontend automatically detects OAuth availability2. Redeploy backend service1. Add OAuth env vars in Dokploy UI (Environment tab)When deploying to Dokploy:## Deployment Notes---```print(users)users = conn.execute("SELECT * FROM users").fetchall()conn = duckdb.connect('/app/data/progress.duckdb')import duckdb```python### Verify Database6. Test protected endpoints with token5. Verify token in browser localStorage4. Check redirect to frontend with token3. Complete Google OAuth2. Navigate to: `http://localhost:8000/api/auth/login`1. Start backend: `uvicorn app.main:app --reload`### Manual Test Flow## Testing---- Ensure it matches your actual frontend domain- Check `FRONTEND_URL` environment variable### OAuth flow redirects to wrong URL- Clear localStorage and re-authenticate- Verify token hasn't expired (default 7 days)- Check that `JWT_SECRET_KEY` matches between backend instances### "Invalid token" errors  - Production: `https://api.spark.preprabbit.in/api/auth/callback`  - Development: `http://localhost:8000/api/auth/callback`- Ensure OAuth redirect URI in Google Console matches exactly:### "Redirect URI mismatch" error## Troubleshooting---- Progress is private to each user- Users can delete their account via backend API- No learning activity is shared with Google- Only minimal user data is stored (email, name, picture URL)### Privacy- [ ] Use environment variables (never commit secrets)- [ ] Set `DEBUG=false` in production- [ ] Restrict OAuth redirect URIs to your domain only- [ ] Configure CORS properly in `ALLOWED_ORIGINS`- [ ] Set strong `JWT_SECRET_KEY` (32+ characters)- [ ] Use HTTPS for all OAuth redirects### Production Checklist## Security Considerations---4. All other features work normally3. Learning progress features will show login prompts but won't break2. Frontend will automatically hide login UI1. Comment out auth-related imports in `backend/app/main.py`If you don't want to set up OAuth during development:## Optional: Skip OAuth for Development---- `GET /api/progress/achievements` - Get user achievements- `POST /api/progress/myth/interact` - Track myth interaction- `POST /api/progress/term/seen` - Mark term as seen- `POST /api/progress/tutorial/complete` - Mark tutorial complete### Protected Endpoints (Require Authentication)| `/api/auth/me` | GET | Get current user info + progress || `/api/auth/logout` | POST | Logout (client clears token) || `/api/auth/verify` | POST | Verify JWT token || `/api/auth/callback` | GET | OAuth callback handler || `/api/auth/login` | GET | Initiate OAuth flow ||----------|--------|-------------|| Endpoint | Method | Description |### Authentication Endpoints## API Endpoints---```);    FOREIGN KEY (user_id) REFERENCES users(id)    last_active TIMESTAMP DEFAULT CURRENT_TIMESTAMP,    unlocked_groups JSON DEFAULT '[1]',    myth_interactions JSON DEFAULT '{}',    seen_terms JSON DEFAULT '[]',    completed_tutorials JSON DEFAULT '[]',    user_id VARCHAR PRIMARY KEY,CREATE TABLE user_progress ();    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP    provider VARCHAR NOT NULL,        -- "google"    picture VARCHAR,    name VARCHAR NOT NULL,    email VARCHAR UNIQUE NOT NULL,    id VARCHAR PRIMARY KEY,           -- "google_123456789"CREATE TABLE users (```sqlUsers are stored in DuckDB with schema:### Database Schema- **Refresh**: Users need to re-authenticate after expiration- **Verification**: Backend validates JWT on protected endpoints- **Storage**: localStorage on client- **Token Lifetime**: 7 days (configurable via `SESSION_EXPIRE_MINUTES`)### Token Management7. Subsequent requests include JWT for user identification6. Frontend stores JWT in localStorage   - Redirects to frontend with token   - Generates JWT token   - Creates/updates user in DuckDB   - Validates OAuth token5. Backend:4. Google redirects to backend `/api/auth/callback`3. User approves permissions2. Redirected to Google OAuth consent screen1. User clicks "Sign In" button### Authentication Flow## How It Works---- Users can still use all other features- Learning path and achievements remain accessible but show login prompts- Login button will not appearIf OAuth is not configured:No additional setup needed! The frontend automatically detects if OAuth is configured on the backend.## Frontend Setup---```openssl rand -base64 32```bashOr use command line:```print(secrets.token_urlsafe(32))import secrets```pythonUse Python to generate a secure secret:### 3. Generate JWT Secret```FRONTEND_URL=https://spark.preprabbit.in# Frontend URL for OAuth redirectsSESSION_EXPIRE_MINUTES=10080  # 7 daysJWT_SECRET_KEY=your-random-secret-key-at-least-32-chars# JWT ConfigurationGOOGLE_CLIENT_SECRET=your-client-secretGOOGLE_CLIENT_ID=your-client-id.apps.googleusercontent.com# Google OAuth```bashAdd to Dokploy environment or `.env` file:### 2. Configure Environment Variables   - Authorized redirect URIs: `https://api.spark.preprabbit.in/api/auth/callback`   - Authorized JavaScript origins: `https://api.spark.preprabbit.in`   - Name: **PrepRabbit Web Client**   - Application type: **Web application**6. Create OAuth 2.0 Client ID:   - `profile`   - `email`   - `openid`5. Add scopes:   - Developer contact: Your email   - User support email: Your email   - App name: **PrepRabbit** (or your app name)   - User Type: **External**4. Configure the OAuth consent screen:3. Click **Create Credentials** â†’ **OAuth 2.0 Client ID**2. Create a new project or select existing one1. Go to [Google Cloud Console](https://console.cloud.google.com/apis/credentials)### 1. Get Google OAuth Credentials## Backend Setup---**All core features work without authentication** - users can use the playground, upload event logs, run simulations, and explore tutorials anonymously.- View personalized learning paths- Save completed tutorials- Unlock achievements and badges- Track their learning progress across devicesGoogle OAuth integration is **optional** and only required if users want to:## Overviewpydantic>=2.5.0
pydantic-settings>=2.1.0
pydantic[email]>=2.5.0
duckdb>=0.9.0
python-multipart>=0.0.6
authlib>=1.3.0
python-jose[cryptography]>=3.3.0
httpx>=0.25.0
